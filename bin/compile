#!/usr/bin/env bash

BUILD=$1
CACHE=$2

cd $2
wget https://github.com/Itseez/opencv/archive/3.2.0.zip
unzip 3*.zip
cd opencv*
mkdir release
cd release
cmake \
-DBUILD_TIFF=ON \
-DBUILD_opencv_java=OFF \
-DWITH_CUDA=OFF \
-DENABLE_AVX=OFF \
-DWITH_OPENGL=OFF \
-DWITH_OPENCL=ON \
-DWITH_IPP=OFF \
-DWITH_TBB=OFF \
-DWITH_EIGEN=OFF \
-DWITH_V4L=OFF \
-DWITH_VTK=OFF \
-DBUILD_TESTS=OFF \
-DBUILD_PERF_TESTS=OFF \
-DCMAKE_BUILD_TYPE=RELEASE \
-DBUILD_opencv_python2=OFF \
-DBUILD_opencv_python3=ON \
-DCMAKE_INSTALL_PREFIX=$(python3 -c "import sys; print(sys.prefix)") \
-DPYTHON3_EXECUTABLE=$(which python3) \
-DPYTHON3_INCLUDE_DIR=$(python3 -c "from distutils.sysconfig import get_python_inc; print(get_python_inc())") \
-DPYTHON3_PACKAGES_PATH=$(python3 -c "from distutils.sysconfig import get_python_lib; print(get_python_lib())") \
..

echo "-----> setting PATHS for opencv and jpeg"
mkdir -p .profile.d
cat << EOF > .profile.d/opencv.sh
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/app/vendor/opencv/lib
export PYTHONPATH=$PYTHONPATH:/app/vendor/opencv/lib/python3.6/site-packages/
EOF

echo "-----> oki"
